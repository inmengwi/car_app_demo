<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì°¨ëŸ‰ìš© ë•…ë”°ë¨¹ê¸° - ì§€ë„ ì˜¤ë²„ë ˆì´ ë””ë²„ê·¸ ë²„ì „</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
 integrity="sha256-sA+e2hZgq3h3u3b5k0K+v/2g8m3Zr3j4lX0hWZr3qPk=" crossorigin=""/>
<style>
  :root{--accent:#1f6feb;--muted:#6b7280;--card:#fff;font-family:Inter,"Noto Sans KR",system-ui,-apple-system,Roboto,"Helvetica Neue",Arial;}
  html,body{height:100%;margin:0;background:#f6f8fb;color:#0f172a;}
  .shell{max-width:1280px;margin:8px auto;background:var(--card);border-radius:12px;padding:12px;box-shadow:0 8px 30px rgba(10,20,40,0.06);box-sizing:border-box;}
  header{display:flex;align-items:center;gap:12px;padding:4px 8px 12px 8px}
  header h1{font-size:18px;margin:0}
  .layout{display:flex;gap:12px}
  .sidebar{width:320px;min-width:220px;padding:8px;box-sizing:border-box}
  .map-area{flex:1; height:72vh; min-height:360px; position:relative}
  #map{height:100%; width:100%; border-radius:10px; border:1px solid rgba(10,20,40,0.04); box-sizing:border-box}
  .panel{background:var(--card); padding:10px; border-radius:8px; box-shadow:0 2px 8px rgba(10,20,40,0.03); margin-bottom:10px;}
  .small{font-size:13px;color:var(--muted)}
  .btn{display:inline-block;padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer;margin-top:8px}
  .stats-row{display:flex;gap:8px;flex-wrap:wrap}
  .stat-b{background:#f3f8ff;padding:8px;border-radius:8px;font-weight:700;color:#06325b}
  @media (max-width:900px){.layout{flex-direction:column}.sidebar{order:2;width:100%}.map-area{order:1;height:62vh}}
  @media (max-width:420px){header h1{font-size:15px}.sidebar{padding:6px}.btn{padding:7px 8px;font-size:13px}.map-area{height:58vh;min-height:300px}}

  /* debug console styles */
  #debugConsole {
    background:#111; color:#0f0; font-family:monospace; font-size:13px;
    padding:8px; border-radius:8px; margin-top:10px; height:200px; overflow-y:auto;
  }
  .log-entry {margin-bottom:2px;}
  .log-entry.warn {color:#ff0;}
  .log-entry.error {color:#f55;}
  #clearLogs {background:#444; border:none; color:#fff; padding:5px 10px; border-radius:6px; cursor:pointer; float:right;}
</style>
</head>
<body>
  <div class="shell">
    <header>
      <div style="width:40px;height:40px;border-radius:8px;background:linear-gradient(180deg,var(--accent),#0b6bd6)"></div>
      <h1>ì°¨ëŸ‰ìš© ë•…ë”°ë¨¹ê¸° â€” ì§€ë„ ì˜¤ë²„ë ˆì´ (ë””ë²„ê·¸ ëª¨ë“œ)</h1>
    </header>

    <div class="layout">
      <aside class="sidebar">
        <div class="panel">
          <div class="small">ì†ë„ (km/h)</div>
          <input id="speedRange" type="range" min="0" max="130" value="40">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;">
            <div>ì†ë„: <strong id="speedVal">40</strong> km/h</div>
            <button id="toggleDrive" class="btn">Start Driving</button>
          </div>
        </div>
        <div class="panel">
          <div class="small">ìë™ í•´ì œ ë°˜ê²½ (m)</div>
          <input id="radius" type="number" value="80" style="width:100%;padding:6px;border-radius:6px;border:1px solid #ccc;margin-top:6px">
          <div class="small" style="margin-top:10px">íƒ€ì¼ í¬ê¸° (m)</div>
          <input id="tileSize" type="number" value="120" style="width:100%;padding:6px;border-radius:6px;border:1px solid #ccc;margin-top:6px">
          <div class="small" style="margin-top:10px">LocalStorage ìºì‹œ <input id="useCache" type="checkbox" checked></div>
        </div>
        <div class="panel">
          <div class="small">í†µê³„</div>
          <div>ì´ íƒ€ì¼: <strong id="totalTiles">0</strong></div>
          <div>í•´ì œ íƒ€ì¼: <strong id="exploredTiles">0</strong></div>
          <div>ì ìœ ìœ¨: <strong id="percent">0%</strong></div>
        </div>
      </aside>

      <section class="map-area">
        <div id="map"></div>
      </section>
    </div>

    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div class="small">ğŸ“Ÿ Debug Console (ëª¨ë°”ì¼ ì „ìš© ë¡œê·¸ ì¶œë ¥)</div>
        <button id="clearLogs">Clear</button>
      </div>
      <div id="debugConsole"></div>
    </div>
  </div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
 integrity="sha256-o9N1j7w9u2g2mN1g+R9KQq3zJxG6g9oZr3+6m+Xv9xA=" crossorigin=""></script>
<script>
/* ---------- Debug console override ---------- */
(function(){
  const consoleDiv = document.getElementById('debugConsole');
  const orig = { log:console.log, warn:console.warn, error:console.error };
  function addLog(msg, type='log'){
    const entry=document.createElement('div');
    entry.className='log-entry '+type;
    const t=new Date().toLocaleTimeString();
    entry.textContent=`[${t}] ${msg}`;
    consoleDiv.appendChild(entry);
    consoleDiv.scrollTop=consoleDiv.scrollHeight;
  }
  console.log = (...args)=>{ orig.log(...args); addLog(args.join(' '),'log'); }
  console.warn = (...args)=>{ orig.warn(...args); addLog(args.join(' '),'warn'); }
  console.error = (...args)=>{ orig.error(...args); addLog(args.join(' '),'error'); }
  document.getElementById('clearLogs').onclick=()=>{consoleDiv.innerHTML='';}
})();

/* ---------- Leaflet map setup ---------- */
console.log('Initializing Leaflet...');
let map = L.map('map', {preferCanvas:true}).setView([37.5665,126.9780], 13);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19}).addTo(map);
console.log('Map created:', map ? 'OK' : 'FAILED');

setTimeout(()=>{map.invalidateSize();console.log('invalidateSize() called after init');},300);
window.addEventListener('resize',()=>{setTimeout(()=>map.invalidateSize(),200);console.log('invalidateSize() on resize');});
window.addEventListener('orientationchange',()=>{setTimeout(()=>map.invalidateSize(),350);console.log('invalidateSize() on orientation');});

/* ---------- Minimal grid demo ---------- */
const layerGroup = L.layerGroup().addTo(map);
function buildGrid(){
  layerGroup.clearLayers();
  const bounds = map.getBounds();
  const {getNorth:getN,getSouth:getS,getWest:getW,getEast:getE}=bounds;
  const n=getN(), s=getS(), w=getW(), e=getE();
  console.log('Building grid in bounds',s,n,w,e);
  const rows=4, cols=6;
  let count=0;
  for(let i=0;i<rows;i++){
    for(let j=0;j<cols;j++){
      const lat1=s+(n-s)/rows*i, lat2=s+(n-s)/rows*(i+1);
      const lng1=w+(e-w)/cols*j, lng2=w+(e-w)/cols*(j+1);
      const rect=L.rectangle([[lat1,lng1],[lat2,lng2]],{color:'#1f6feb',weight:1,fillOpacity:0.2});
      rect.on('click',()=>{rect.setStyle({fillColor:'#dff4ff',fillOpacity:0.9});console.log('Tile clicked',i,j);});
      rect.addTo(layerGroup); count++;
    }
  }
  console.log('Grid built:',count,'tiles');
}
buildGrid();
map.on('moveend',()=>{console.log('map moveend');buildGrid();});

</script>
</body>
</html>
